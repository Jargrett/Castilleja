emotes::install_version("Matrix", version = "1.6.3")
remotes::install_version("Matrix", version = "1.6.3")
install.packages("lme4", type = "source")  # 1.1.35.1
remotes::install_version("Matrix", version = "1.6.4")
library(lme4)
library(metagear)
install.packages("gasanalyzer")
library(gasanalyzer)
#Belowground Analysis
setwd("/Users/jargrett/Desktop/Castilleja/Data Analysis/RMBL/2024 Argrett")
library(tidyverse)#for data wrangling and restructuring
library(plyr)#for data wrangling and restructuring
library(ggplot2)#for plotting
library(ggpubr)#extended functions for plottinglibrary(remotes)
library(ggpattern)
library(car)#for regression analysis
library(emmeans)#post-hoc analysis
library(lme4)#for modeling linear mixed effect models
library(GGally)#this is new
library(factoextra)#this is new
soil <- read.csv("Soil Nutrients - Full.csv")
soil.ex <- read.csv("Soil Nutrients - Full Excluded.csv")
soil <- as.data.frame(unclass(soil),stringsAsFactors=TRUE)
soil.full <- filter(soil, burial == "full study")
soil.overwinter <- filter(soil, burial == "overwinter")
soil.within <- filter(soil, burial == "within")
soil.year <- filter(soil, burial == "year")
nitrate <- ggplot(soil, aes(x = litter, y = NH4)) +
geom_point(aes(color = (removal))) +
facet_wrap(~burial) +
labs(x = "Litter Treatment", y = "NO3")
nitrate
nitrate.lme <- lmer(K ~ litter*removal + (1|block) + (1|pair), data = soil.full)
summary(nitrate.lme)
Anova(nitrate.lme)
emmip(nitrate.lme, litter ~ removal)
emmeans(nitrate.lme, pairwise ~  removal|litter)
soil.NO3 <- soil.full %>%
group_by(litter,removal,burial) %>%
dplyr::summarise(mean= mean(K),
se = sd(K)/sqrt(n()))
NO3.plot <- ggplot(data = soil.NO3, aes(x = litter, y = mean, fill = removal, pattern = removal)) +
geom_bar(stat="identity", color="black",position=position_dodge2(preserve="single", padding=0), alpha=0.5) +
geom_errorbar(aes(ymin=mean, ymax=mean+se), alpha=1, width=.2,position=position_dodge(.9)) +
theme(panel.grid = element_blank(),legend.position = "bottom") +
labs(x="Litter Type", y="Nitrate (micro grams/10cm2/burial length)", pattern="") + scale_fill_manual(values=cols)+
geom_bar_pattern(stat="identity", position = "dodge", color = "black", pattern_angle = 45, pattern_density = 0.1, pattern_spacing = 0.025, pattern_key_scale_factor = 0.6) +
scale_fill_manual( values=c("#004D40", "#FFC107"))
NO3.plot
Anova(nitrate.lme)
a<-ggplot(COroots, aes(x = Invasion, y = mean, fill = grp, pattern=Treatment, alpha=alfa)) +
geom_bar(stat="identity", color="black",position=position_dodge2(preserve="single", padding=0), alpha=0.5) +
geom_errorbar(aes(ymin=mean, ymax=mean+se), alpha=1, width=.2,position=position_dodge(.9)) +
theme(panel.grid = element_blank(),legend.position = "bottom") +
labs(x="Soil Type", y="Root Mass (g)", pattern="") + scale_fill_manual(values=cols)+
geom_bar_pattern(stat="identity", position = "dodge", color = "black", pattern_angle = 45, pattern_density = 0.1, pattern_spacing = 0.025, pattern_key_scale_factor = 0.6) +
scale_pattern_manual(values = c("stripe", "none")) +
theme(axis.text.x = element_text(size=11, colour= "black", angle = 0),axis.text.y = element_text(size=12, colour="black"),strip.text = element_text(size = 10))+
theme(axis.title.x = element_text(size=12, colour="black"), axis.title.y = element_text(size= 12, colour = "black"))+
theme(legend.title = element_blank())+theme(axis.ticks.x = element_blank())+
theme(panel.grid = element_blank(),legend.position = "bottom")+
theme(legend.title = element_blank())+theme(legend.text = element_text(size = 10, colour = "black"))+
theme(legend.background = element_blank())+ylim(0, 2.0) +
facet_grid(~ Grown, scales = "free") +
geom_signif(data=data.frame(Grown=c("Linaria", "Native")), aes(xmin =c(1,1), xmax = c(2,2), y_position = c(0.95, 1.95), annotations=c("*","*")), tip_length = 0, manual=T, inherit.aes = FALSE) +
guides(pattern = guide_legend(override.aes = list(fill = "white")),fill = guide_legend(override.aes = list(pattern = "none"))) +
guides(fill=FALSE)+ guides(size="none", alpha="none")
#remove rows if NAs occur in any of the variables we care about
soil.full <- subset(soil.full, select = -c(B, S, Pb, Al, Cd))
soil.full <- soil.full %>% filter_at(vars(NO3, NH4, Ca, Mg, K, P, Fe, Mn, Cu, Zn),
all_vars(!is.na(.)))
#Examine correlations among the body shape response variables------
#ggpairs plots is a good way to get lots of info (GGally package)
ggpairs(soil.full, mapping = aes(color = litter),
columns = c("NO3", "NH4",
"K", "P"))+
scale_colour_manual(values = c("coral4","darkolivegreen3","deepskyblue4","darkgoldenrod2")) +
scale_fill_manual(values = c("coral4","darkolivegreen3","deepskyblue4","darkgoldenrod2"))
#PCA analysis--------------------
full.pca <- prcomp (~ NO3 + NH4 + Ca + Mg + K + P + Fe + Mn + Cu + Zn,
data=soil.full,
scale. = TRUE) #Make sure to scale variables!
#Get factor loadings on principle components
full.pca
#Visualize how much variation is explained by each principle component (Scree plot)
#Basic plot
plot(full.pca)#however, this gives us the absolute variances, not % of total variance
#Use function from a different package (factoextra) for nicer plot
fviz_eig(full.pca,addlabels = TRUE)
#Visualize results in a biplot--------
fviz_pca_biplot(full.pca, label = "var",
col.ind = full.pca$litter, palette = c("coral4","darkgoldenrod2","deepskyblue4","darkolivegreen3"),
col.var = "black", repel = TRUE,
legend.title = "Litter Treatment")
#Visualize results in a biplot--------
fviz_pca_biplot(full.pca, label = "var",
col.ind = full.pca$litter, palette = c("coral4","darkgoldenrod2","deepskyblue4","darkolivegreen3"),
col.var = "black", repel = TRUE,
legend.title = "Litter Treatment")
